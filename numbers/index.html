<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lottery Submission</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css">
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center">Lottery Submission</h1>
        <form id="lotteryForm" class="mt-4">
            <div class="mb-3">
                <label for="name" class="form-label">Name</label>
                <input type="text" class="form-control" id="name" name="name" required>
            </div>
            <div class="mb-3">
                <label class="form-label">Choose 6 Numbers (1-37)</label>
                <div id="numberChoices" class="d-flex flex-wrap">
                    <!-- Number buttons will be generated here dynamically -->
                </div>
                <small id="numberError" class="text-danger d-none">Please select exactly 6 numbers.</small>
            </div>
            <div class="mb-3">
                <label class="form-label">Choose a Strong Number (1-7)</label>
                <div id="strongNumberChoices" class="d-flex">
                    <!-- Strong number buttons will be generated here dynamically -->
                </div>
                <small id="strongNumberError" class="text-danger d-none">Please select one strong number.</small>
            </div>
            <button type="submit" class="btn btn-primary">Submit</button>
        </form>
    </div>

    <script>
        // Generate number buttons for 1-37
        const numberChoices = document.getElementById('numberChoices');
        for (let i = 1; i <= 37; i++) {
            const button = document.createElement('button');
            button.type = 'button';
            button.textContent = i;
            button.className = 'btn btn-outline-primary m-1 number-btn';
            button.addEventListener('click', () => toggleSelection(button, 'number'));
            numberChoices.appendChild(button);
        }

        // Generate strong number buttons for 1-7
        const strongNumberChoices = document.getElementById('strongNumberChoices');
        for (let i = 1; i <= 7; i++) {
            const button = document.createElement('button');
            button.type = 'button';
            button.textContent = i;
            button.className = 'btn btn-outline-success m-1 strong-btn';
            button.addEventListener('click', () => toggleSelection(button, 'strong'));
            strongNumberChoices.appendChild(button);
        }

        // Track selections
        const selectedNumbers = new Set();
        let selectedStrongNumber = null;

        function toggleSelection(button, type) {
            const value = parseInt(button.textContent);

            if (type === 'number') {
                if (selectedNumbers.has(value)) {
                    selectedNumbers.delete(value);
                    button.classList.remove('btn-primary');
                    button.classList.add('btn-outline-primary');
                } else if (selectedNumbers.size < 6) {
                    selectedNumbers.add(value);
                    button.classList.remove('btn-outline-primary');
                    button.classList.add('btn-primary');
                }
            } else if (type === 'strong') {
                if (selectedStrongNumber === value) {
                    selectedStrongNumber = null;
                    button.classList.remove('btn-success');
                    button.classList.add('btn-outline-success');
                } else {
                    selectedStrongNumber = value;
                    document.querySelectorAll('.strong-btn').forEach(btn => {
                        btn.classList.remove('btn-success');
                        btn.classList.add('btn-outline-success');
                    });
                    button.classList.remove('btn-outline-success');
                    button.classList.add('btn-success');
                }
            }
        }

        document.getElementById('lotteryForm').addEventListener('submit', async event => {
            event.preventDefault();

            const name = document.getElementById('name').value.trim();
            const numberError = document.getElementById('numberError');
            const strongNumberError = document.getElementById('strongNumberError');

            // Validate selections
            if (selectedNumbers.size !== 6) {
                numberError.classList.remove('d-none');
                return;
            } else {
                numberError.classList.add('d-none');
            }

            if (!selectedStrongNumber) {
                strongNumberError.classList.remove('d-none');
                return;
            } else {
                strongNumberError.classList.add('d-none');
            }

            // Send data to backend
            const formData = {
                name,
                numbers: Array.from(selectedNumbers),
                strongNumber: selectedStrongNumber
            };

            try {
                const response = await fetch('http://localhost:3000/submit', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });

                if (response.ok) {
                    alert('Your submission has been recorded!');
                    document.getElementById('lotteryForm').reset();
                    selectedNumbers.clear();
                    selectedStrongNumber = null;
                    document.querySelectorAll('.btn-primary').forEach(btn => btn.classList.replace('btn-primary', 'btn-outline-primary'));
                    document.querySelectorAll('.btn-success').forEach(btn => btn.classList.replace('btn-success', 'btn-outline-success'));
                } else {
                    alert('There was an error submitting your data. Please try again.');
                }
            } catch (error) {
                console.error('Error submitting data:', error);
                alert('There was an error connecting to the server.');
            }
        });
    </script>
</body>
</html>
